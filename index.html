document.addEventListener('DOMContentLoaded', () => {
    const player = document.getElementById('player');
    const gameContainer = document.getElementById('game-container');
    const scoreDisplay = document.getElementById('score-display');
    
    let score = 0;
    let isJumping = false;
    let isMovingLeft = false;
    let isMovingRight = false;
    let gravity = 0.9;
    let playerVelocityY = 0;
    let playerVelocityX = 0;
    let playerX = 100;
    let playerY = 350;
    let platforms = [];
    let coins = [];
    
    // Create platforms
    function createPlatform(x, y, width) {
        const platform = document.createElement('div');
        platform.className = 'platform';
        platform.style.width = `${width}px`;
        platform.style.left = `${x}px`;
        platform.style.bottom = `${y}px`;
        gameContainer.appendChild(platform);
        platforms.push({
            element: platform,
            x: x,
            y: y,
            width: width,
            height: 20
        });
    }
    
    // Create coins
    function createCoin(x, y) {
        const coin = document.createElement('div');
        coin.className = 'coin';
        coin.style.left = `${x}px`;
        coin.style.bottom = `${y}px`;
        gameContainer.appendChild(coin);
        coins.push({
            element: coin,
            x: x,
            y: y,
            width: 20,
            height: 20,
            collected: false
        });
    }
    
    // Initialize game elements
    function initGame() {
        // Ground is at y=0 (handled by #ground element)
        
        // Add some platforms
        createPlatform(200, 100, 150);
        createPlatform(400, 200, 150);
        createPlatform(600, 150, 150);
        
        // Add some coins
        createCoin(250, 170);
        createCoin(450, 270);
        createCoin(650, 220);
        createCoin(300, 400);
        createCoin(700, 400);
    }
    
    // Check collision between player and another object
    function checkCollision(player, obj) {
        return player.x < obj.x + obj.width &&
               player.x + player.offsetWidth > obj.x &&
               player.y < obj.y + obj.height &&
               player.y + player.offsetHeight > obj.y;
    }
    
    // Handle keyboard input
    document.addEventListener('keydown', (e) => {
        switch(e.key) {
            case 'ArrowLeft':
                isMovingLeft = true;
                break;
            case 'ArrowRight':
                isMovingRight = true;
                break;
            case ' ':
                if (!isJumping) {
                    isJumping = true;
                    playerVelocityY = 15;
                }
                break;
        }
    });
    
    document.addEventListener('keyup', (e) => {
        switch(e.key) {
            case 'ArrowLeft':
                isMovingLeft = false;
                break;
            case 'ArrowRight':
                isMovingRight = false;
                break;
        }
    });
    
    // Game loop
    function gameLoop() {
        // Handle player movement
        if (isMovingLeft) playerVelocityX = -5;
        else if (isMovingRight) playerVelocityX = 5;
        else playerVelocityX = 0;
        
        // Apply gravity
        playerVelocityY -= gravity;
        
        // Update player position
        playerX += playerVelocityX;
        playerY += playerVelocityY;
        
        // Boundary checking (left/right)
        if (playerX < 0) playerX = 0;
        if (playerX > gameContainer.offsetWidth - player.offsetWidth) {
            playerX = gameContainer.offsetWidth - player.offsetWidth;
        }
        
        // Check if player is on ground or platform
        let onGround = false;
        
        // Ground collision
        if (playerY <= 100) {
            playerY = 100;
            playerVelocityY = 0;
            isJumping = false;
            onGround = true;
        }
        
        // Platform collisions
        platforms.forEach(platform => {
            if (playerY <= platform.y + platform.height && 
                playerY + player.offsetHeight >= platform.y &&
                playerX + player.offsetWidth > platform.x && 
                playerX < platform.x + platform.width &&
                playerVelocityY < 0) {
                
                playerY = platform.y + platform.height;
                playerVelocityY = 0;
                isJumping = false;
                onGround = true;
            }
        });
        
        // If not on ground or platform, player is falling
        if (!onGround && playerY > 100) {
            isJumping = true;
        }
        
        // Coin collection
        coins.forEach(coin => {
            if (!coin.collected && checkCollision({
                x: playerX,
                y: playerY,
                width: player.offsetWidth,
                height: player.offsetHeight
            }, coin)) {
                coin.collected = true;
                coin.element.style.display = 'none';
                score += 10;
                scoreDisplay.textContent = `Score: ${score}`;
                
                // Play a sound if available (commented out as it requires additional setup)
                // const coinSound = new Audio('coin.mp3');
                // coinSound.play();
            }
        });
        
        // Update player position in DOM
        player.style.left = `${playerX}px`;
        player.style.bottom = `${playerY}px`;
        
        // Check if all coins are collected
        if (coins.every(coin => coin.collected)) {
            // You can add a win condition here
            scoreDisplay.textContent = `You Win! Score: ${score}`;
        }
        
        requestAnimationFrame(gameLoop);
    }
    
    // Start the game
    initGame();
    gameLoop();
});
